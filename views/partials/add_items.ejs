<link rel="stylesheet" href="/stylesheets/add_items.css">

<div class="main-add-items-container hidden">
    <p class="close-btn"><span class="close">X</span></p>
    <div class="content">
        <h1>Add a new item</h1>
        <p>Hold the button below and say your new reminder</p>

        <button id="record-button" class="record-button"><img
                src="https://img.icons8.com/fluent-systems-filled/36/FFFFFF/microphone.png" /></button>
        <input type="text" id="input" class="recording-output" required></input>
        <button id="submit-button">Sort</button>
        <form>
            <h5>Title</h5>
            <input type="text" id="action-input" required>
            <h5>Category</h5>
            <fieldset id="category-input" required>
                <label for="Medication">
                    <input type="radio" name="category" value="medication" id="Medication" required />
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g opacity="0.7">
                            <path
                                d="M14.7586 8.78803L10.8173 4.85248L4.93555 10.9067L8.7951 14.7667L8.79554 14.7663C9.55954 15.5285 10.6138 16 11.7778 16C14.1093 16 16 14.1094 16 11.7778C16 10.6098 15.5253 9.55248 14.7586 8.78803Z"
                                fill="#8FC5A8" />
                            <path
                                d="M7.07599 1.11689C6.32399 0.425333 5.32399 0 4.22222 0C1.89022 0 0 1.89022 0 4.22222C0 5.324 0.425777 6.32444 1.11733 7.076L1.11111 7.08222L4.93555 10.9067L10.8173 4.85244L7.07599 1.11689Z"
                                fill="#CA5C1D" />
                        </g>
                    </svg>
                    <span>Medication</span>
                </label>

                <label for="Bills">
                    <input type="radio" name="category" value="Bills" id="Bills" />
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g opacity="0.7">
                            <path
                                d="M14.949 10.6391C14.65 7.69778 13 6.22222 13 6.22222L10 2.66667H6L3 6.22222C3 6.22222 2.2905 6.85911 1.7165 8.12222C0.722 8.41556 0 9.23956 0 10.2222C0 10.8658 0.3125 11.4409 0.8045 11.8467C0.6165 12.1587 0.5 12.5098 0.5 12.8889C0.5 13.7591 1.068 14.5049 1.8875 14.8693C2.529 15.7236 3.386 16 4 16H12C12.6895 16 13.6865 15.6538 14.339 14.5289C15.3045 14.2218 16 13.4089 16 12.4444C16 11.6987 15.583 11.0427 14.949 10.6391ZM8 2.66667C8.275 2.66667 8.529 2.59644 8.75 2.48178C8.9715 2.59644 9.2255 2.66667 9.5 2.66667C10.3285 2.66667 11.5 1.62489 11.5 0.888889C11.5 0.888889 11.5 0 10.5 0C10.106 0 10 0.444444 9.5 0.444444C9 0.444444 9 0 8 0C7 0 7 0.444444 6.5 0.444444C6 0.444444 5.8945 0 5.5 0C4.5 0 4.5 0.888889 4.5 0.888889C4.5 1.62489 5.672 2.66667 6.5 2.66667C6.7745 2.66667 7.0285 2.59644 7.25 2.48178C7.4715 2.59644 7.7255 2.66667 8 2.66667Z"
                                fill="#FDD888" />
                            <path
                                d="M10.95 10.3742C10.95 8.38445 6.65952 8.51423 6.65952 7.31378C6.65952 6.73245 7.31002 6.44845 8.06502 6.44845C9.33402 6.44845 9.56002 7.14578 10.1345 7.14578C10.541 7.14578 10.737 6.92667 10.737 6.68089C10.737 6.11023 9.72502 5.67823 8.75452 5.52889V4.97778C8.75452 4.63423 8.42952 4.35556 8.02752 4.35556C7.62502 4.35556 7.29952 4.63423 7.29952 4.97778V5.548C6.24152 5.75378 5.33102 6.38134 5.33102 7.404C5.33102 9.31467 9.62052 9.23734 9.62052 10.5796C9.62052 11.0449 9.03152 11.5098 8.06502 11.5098C6.61452 11.5098 6.13152 10.6702 5.54252 10.6702C5.25552 10.6702 4.99902 10.8764 4.99902 11.1876C4.99902 11.6822 5.96802 12.2769 7.30052 12.4427L7.30002 12.4471V13.0684C7.30002 13.4116 7.62602 13.6907 8.02802 13.6907C8.43002 13.6907 8.75552 13.4116 8.75552 13.0684V12.4471C8.75552 12.4396 8.75152 12.4338 8.75102 12.4271C9.95002 12.236 10.95 11.5684 10.95 10.3742Z"
                                fill="#6A93A0" />
                            <path
                                d="M10.7998 2.04445C10.7998 2.28978 10.5763 2.48889 10.2998 2.48889H5.2998C5.0238 2.48889 4.7998 2.28978 4.7998 2.04445C4.7998 1.79912 5.0238 1.60001 5.2998 1.60001H10.2998C10.5763 1.60001 10.7998 1.79912 10.7998 2.04445Z"
                                fill="#CA5C1D" />
                        </g>
                    </svg>
                    <span>Bills</span>
                </label>

                <label for="Appointments">
                    <input type="radio" name="category" value="Appointments" id="Appointments" />
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g opacity="0.7">
                            <path d="M13.4072 1.7067H14.4052V2.15336H13.4072V1.7067Z" fill="#66757F" />
                            <path
                                d="M0 5.28003V14.2133C0 15.2 0.8955 16 2 16H14C15.1045 16 16 15.2 16 14.2133V5.28003H0Z"
                                fill="#CCD6DD" />
                            <path
                                d="M14 1.7067H2C0.8955 1.7067 0 2.50667 0 3.49336V5.72668H16V3.49336C16 2.50667 15.1045 1.7067 14 1.7067Z"
                                fill="#CA5C1D" />
                            <path
                                d="M3.41773 3.81989C3.06673 3.81989 2.78223 3.52241 2.78223 3.1548C2.78223 2.78764 3.06673 2.48972 3.41773 2.48972C3.76823 2.48972 4.05273 2.78764 4.05273 3.1548C4.05273 3.52196 3.76823 3.81989 3.41773 3.81989ZM6.41773 3.81989C6.06673 3.81989 5.78223 3.52241 5.78223 3.1548C5.78223 2.78764 6.06673 2.48972 6.41773 2.48972C6.76823 2.48972 7.05273 2.78764 7.05273 3.1548C7.05273 3.52196 6.76823 3.81989 6.41773 3.81989ZM9.41773 3.81989C9.06673 3.81989 8.78223 3.52241 8.78223 3.1548C8.78223 2.78764 9.06673 2.48972 9.41773 2.48972C9.76823 2.48972 10.0532 2.78764 10.0532 3.1548C10.0527 3.52196 9.76823 3.81989 9.41773 3.81989ZM12.4177 3.81989C12.0667 3.81989 11.7822 3.52241 11.7822 3.1548C11.7822 2.78764 12.0667 2.48972 12.4177 2.48972C12.7682 2.48972 13.0532 2.78764 13.0532 3.1548C13.0527 3.52196 12.7682 3.81989 12.4177 3.81989Z"
                                fill="#292F33" />
                            <path
                                d="M12.6572 0C12.0187 0 11.4657 0.358226 11.1602 0.879931C10.8572 0.369392 10.3017 0 9.65723 0C9.01873 0 8.46573 0.358226 8.16023 0.879931C7.85723 0.369392 7.30173 0 6.65723 0C6.01873 0 5.46573 0.358226 5.16023 0.879931C4.85723 0.369392 4.30173 0 3.65723 0C2.69023 0 1.90723 0.812484 1.90723 1.78889C1.90723 2.61701 2.42973 3.2946 3.19173 3.5425C3.57123 3.66534 3.80373 3.34284 3.77123 3.08422C3.74373 2.86983 3.58423 2.73002 3.40673 2.62952C3.16423 2.49239 2.90673 2.17928 2.90673 1.79113C2.90673 1.29801 3.24223 0.855364 3.65673 0.855364C4.07123 0.855364 4.40673 1.2596 4.40673 1.70626H4.91473C4.91323 1.73396 4.90673 1.76031 4.90673 1.78845C4.90673 2.61657 5.42923 3.29416 6.19123 3.54206C6.57073 3.66489 6.80323 3.3424 6.77073 3.08378C6.74323 2.86983 6.58373 2.73002 6.40623 2.62952C6.16373 2.49239 5.90623 2.17928 5.90623 1.79113C5.90623 1.29801 6.24173 0.855364 6.65623 0.855364C7.07073 0.855364 7.40723 1.26004 7.40723 1.70671H7.91523C7.91373 1.7344 7.90723 1.76075 7.90723 1.78889C7.90723 2.61701 8.42973 3.2946 9.19173 3.5425C9.57123 3.66534 9.80373 3.34284 9.77123 3.08422C9.74373 2.87027 9.58423 2.73047 9.40673 2.62997C9.16423 2.49284 8.90673 2.17973 8.90673 1.79157C8.90673 1.29846 9.24223 0.855811 9.65673 0.855811C10.0712 0.855811 10.4072 1.26004 10.4072 1.70671H10.9152C10.9137 1.7344 10.9072 1.76075 10.9072 1.78889C10.9072 2.61701 11.4297 3.2946 12.1917 3.5425C12.5712 3.66534 12.8037 3.34284 12.7712 3.08422C12.7437 2.87027 12.5842 2.73047 12.4067 2.62997C12.1642 2.49284 11.9067 2.17973 11.9067 1.79157C11.9067 1.29846 12.2422 0.855811 12.6567 0.855811C13.0712 0.855811 13.4072 1.26004 13.4072 1.70671H14.4052C14.3947 0.813378 13.6172 0 12.6572 0Z"
                                fill="#66757F" />
                            <path
                                d="M4.5 6.62003H6.5V8.40669H4.5V6.62003ZM7 6.62003H9V8.40669H7V6.62003ZM9.5 6.62003H11.5V8.40669H9.5V6.62003ZM12 6.62003H14V8.40669H12V6.62003ZM2 8.85335H4V10.64H2V8.85335ZM4.5 8.85335H6.5V10.64H4.5V8.85335ZM7 8.85335H9V10.64H7V8.85335ZM9.5 8.85335H11.5V10.64H9.5V8.85335ZM12 8.85335H14V10.64H12V8.85335ZM2 11.0867H4V12.8733H2V11.0867ZM4.5 11.0867H6.5V12.8733H4.5V11.0867ZM7 11.0867H9V12.8733H7V11.0867ZM9.5 11.0867H11.5V12.8733H9.5V11.0867ZM12 11.0867H14V12.8733H12V11.0867ZM2 13.32H4V15.1067H2V13.32ZM4.5 13.32H6.5V15.1067H4.5V13.32ZM7 13.32H9V15.1067H7V13.32Z"
                                fill="white" />
                        </g>
                    </svg>
                    <span>Appointments</span>
                </label>

                <label for="Tasks">
                    <input type="radio" name="category" value="Tasks" id="Tasks" />
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M16.2222 19C17.7563 19 19 17.7563 19 16.2222V3.77778C19 2.24372 17.7563 1 16.2222 1H3.77778C2.24372 1 1 2.24372 1 3.77778V16.2222C1 17.7563 2.24372 19 3.77778 19H16.2222Z"
                            fill="#8FC5A8" stroke="#6A93A0" stroke-width="2" />
                        <path
                            d="M15.0137 4.82757C14.4999 4.49379 13.8119 4.64002 13.4768 5.15468L8.63856 12.612L6.40345 10.5453C5.95278 10.1285 5.24967 10.1565 4.83323 10.6067C4.41678 11.0573 4.44434 11.7605 4.895 12.1769L8.099 15.1396C8.31234 15.3373 8.58345 15.4351 8.85278 15.4351C9.15189 15.4351 9.53456 15.3098 9.78567 14.9289C9.93323 14.704 15.3412 6.36446 15.3412 6.36446C15.675 5.84935 15.5283 5.16135 15.0137 4.82757Z"
                            fill="white" />
                    </svg>
                    <span>Tasks</span>
                </label>
            </fieldset>
            <h5>Notes</h5>
            <textarea></textarea>
            <div class="datetime">
                <div>
                    <h5>Date</h5>
                    <input type="date" id="date-input" required>
                </div>
                <div>
                    <h5>Time</h5>
                    <input type="time" id="time-input" required>
                </div>
            </div>
            <input type="checkbox" id="recurrence-input">
            <label for="recurrence-input"> Recurring </label><br>
            <h5>Recurrence Interval</h5>
            <input type="text" id="recurrence-interval-input"><br>
            <button id="submit-form">Add Reminder</button>
        </form>
    </div>


    <script>
        //---------------Cached Variables------------//    
        let input = document.getElementById("input")
        let submitButton = document.getElementById("submit-button")
        let category = document.getElementById("category-input")
        let date = document.getElementById("date-input")
        let time = document.getElementById("time-input")
        let recordButton = document.getElementById("record-button")
        let action = document.getElementById("action-input")
        let recurrence = document.getElementById("recurrence-input")
        let recurrenceInterval = document.getElementById("recurrence-interval-input")

        //---------------state Variables------------//    
        let recordingOn = false;

        //---------------Event Listeners below------------//
        submitButton.addEventListener("click", getCategory)

        // Start Listening on button hold
        recordButton.addEventListener("mousedown", function (e) {
            if (recordingOn == false) {
                recognition.start();
                recordingOn = true;
            }
        })

        // Stop listening on button release
        recordButton.addEventListener("mouseup", function (e) {
            if (recordingOn == true) {
                recognition.stop();
                recordingOn = false;
            }
        })

        //---------------WebSpeech Recognition API------------//
        window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.interimResults = true;

        recognition.addEventListener("result", function (e) {
            const text = e.results[0][0].transcript;
            input.value = text;
        });


        //---------------AJAX call to Server------------//
        async function getCategory(e) {
            let body = { "input": input.value }
            //send input to controller function fillForm
            const response = await fetch("/fillForm", {
                method: 'POST',
                cache: 'no-cache',
                credentials: 'same-origin',
                headers: {
                    'Content-Type': "application/json"
                },
                redirect: 'follow',
                referrerPolicy: 'no-referrer',
                body: JSON.stringify(body)
            }).then(res => res.json());
            console.log(response)

            // set action input
            action.value = response.action
            // set category input
            let target = document.getElementById(`${response.category}`);
            target.checked = true;
            // category.value = response.category;

            // set date and time input
            if (response.datetime !== "") {
                datetime = new Date(response.datetime)
                date.value = datetime.toISOString().slice(0, 10)
                time.value = datetime.toISOString().slice(11, 16)
            }

            // set recurrence and interval
            if (response.repeat) {
                recurrence.checked = true;
                recurrenceInterval.value = response.repeatInterval;
            }
            else {
                recurrence.checked = false;
                recurrenceInterval.value = "";
            }
        }

    </script>
</div>